Version 4
SHEET 1 1608 756
WIRE 48 64 -272 64
WIRE 192 64 48 64
WIRE 400 64 288 64
WIRE 560 64 400 64
WIRE 48 80 48 64
WIRE 400 80 400 64
WIRE 560 176 560 64
WIRE -272 192 -272 64
WIRE 48 288 48 144
WIRE 400 288 400 144
WIRE 128 304 96 304
WIRE 240 304 208 304
WIRE 352 304 240 304
WIRE 48 416 48 384
WIRE 240 416 240 304
WIRE 240 416 48 416
WIRE 272 416 272 112
WIRE 400 416 400 384
WIRE 400 416 272 416
WIRE 48 432 48 416
WIRE 400 432 400 416
WIRE 560 432 560 256
WIRE -272 448 -272 272
WIRE 48 560 48 512
WIRE 400 560 400 512
FLAG -272 448 0
FLAG 48 560 0
FLAG 400 560 0
FLAG 560 432 0
SYMBOL pmos 192 112 R270
SYMATTR InstName M1
SYMATTR Value AO6407
SYMBOL pmos 96 384 R180
SYMATTR InstName M2
SYMATTR Value AO6407
SYMBOL pmos 352 384 M180
SYMATTR InstName M3
SYMATTR Value AO6407
SYMBOL res 32 416 R0
SYMATTR InstName R1
SYMATTR Value 3.3k
SYMBOL res 384 416 R0
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL voltage -272 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value SINE(20 20 70)
SYMBOL voltage 560 160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=100
SYMATTR InstName V2
SYMATTR Value 5
SYMBOL schottky 32 80 R0
SYMATTR InstName D1
SYMATTR Value BAT54
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky 384 80 R0
SYMATTR InstName D2
SYMATTR Value BAT54
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL voltage 224 304 R90
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 0.1
TEXT -304 472 Left 2 !;.dc v1 -10 10
TEXT -280 568 Left 2 ;150µA ideal diode leakage
TEXT -280 608 Left 2 ;D1 & D2 protect M3 when V1<0.  Remove D1 & D2 when V1 always >0
TEXT -312 512 Left 2 !.tran 100m
TEXT -272 648 Left 2 ;https://birds-are-nice.me/projects/magic_diode/
TEXT -272 712 Left 2 ;M1 & M3 should be matched, otherwise difference in Vgsth might cause\nM3 to turn off too slowly.
