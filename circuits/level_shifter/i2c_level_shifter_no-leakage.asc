Version 4
SHEET 1 2320 1212
WIRE 1488 -656 1248 -656
WIRE 1552 -656 1488 -656
WIRE 1248 -624 1248 -656
WIRE 1552 -608 1552 -656
WIRE 1056 -496 1008 -496
WIRE 1248 -496 1248 -544
WIRE 1248 -496 1120 -496
WIRE 1328 -496 1248 -496
WIRE 1344 -496 1328 -496
WIRE 1552 -464 1552 -528
WIRE 1248 -448 1248 -496
WIRE 1248 -304 1248 -368
WIRE 448 -160 -336 -160
WIRE 560 -160 448 -160
WIRE 2064 -160 1248 -160
WIRE 448 -128 448 -160
WIRE 1248 -128 1248 -160
WIRE 560 -48 560 -160
WIRE -48 0 -192 0
WIRE 448 0 448 -48
WIRE 448 0 32 0
WIRE 544 0 448 0
WIRE 720 0 640 0
WIRE 1008 0 1008 -496
WIRE 1008 0 720 0
WIRE 1056 0 1008 0
WIRE 1248 0 1248 -48
WIRE 1248 0 1120 0
WIRE 1328 0 1248 0
WIRE 1344 0 1328 0
WIRE 448 32 448 0
WIRE 1248 48 1248 0
WIRE 448 176 448 112
WIRE 1248 192 1248 128
WIRE 1248 256 1168 256
WIRE 1488 256 1488 -656
WIRE 1488 256 1248 256
WIRE 1248 288 1248 256
WIRE 1168 368 1168 256
WIRE 1088 416 1008 416
WIRE 1248 416 1248 368
WIRE 1248 416 1184 416
WIRE 1328 416 1248 416
WIRE 1344 416 1328 416
WIRE 1248 464 1248 416
WIRE 1248 608 1248 544
WIRE -336 704 -336 -160
WIRE 464 704 -336 704
WIRE 576 704 464 704
WIRE 1248 704 1168 704
WIRE 2064 704 2064 -160
WIRE 2064 704 1248 704
WIRE 464 736 464 704
WIRE 1248 736 1248 704
WIRE 576 816 576 704
WIRE 1168 816 1168 704
WIRE -192 864 -192 0
WIRE -64 864 -192 864
WIRE 464 864 464 816
WIRE 464 864 16 864
WIRE 560 864 464 864
WIRE 768 864 656 864
WIRE 1008 864 1008 416
WIRE 1008 864 768 864
WIRE 1088 864 1008 864
WIRE 1248 864 1248 816
WIRE 1248 864 1184 864
WIRE 1328 864 1248 864
WIRE 1344 864 1328 864
WIRE 464 896 464 864
WIRE -336 912 -336 704
WIRE -192 912 -192 864
WIRE 1248 912 1248 864
WIRE 1392 912 1392 864
WIRE 2064 928 2064 704
WIRE -336 1040 -336 992
WIRE -192 1040 -192 992
WIRE 464 1040 464 976
WIRE 1248 1056 1248 992
WIRE 1392 1056 1392 992
WIRE 2064 1056 2064 1008
FLAG -336 1040 0
FLAG -192 1040 0
FLAG 1248 1056 0
FLAG 2064 1056 0
FLAG 1392 1056 0
FLAG 464 1040 0
FLAG 768 864 SDA
FLAG 1328 864 SDA1
FLAG 448 176 0
FLAG 720 0 SCL
FLAG 1248 192 0
FLAG 1328 0 SCL1
FLAG 1248 -304 0
FLAG 1328 -496 SCL2
FLAG 1552 -464 0
FLAG 1248 608 0
FLAG 1328 416 SDA2
SYMBOL nmos 656 816 R90
SYMATTR InstName M1
SYMATTR Value BSS138P
SYMATTR Prefix X
SYMBOL voltage -192 896 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=100
SYMATTR InstName V1
SYMATTR Value PULSE(0 1.8 0 1n 1n {1/baudrate} {2/baudrate})
SYMBOL voltage -336 896 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 1.8
SYMBOL res 1232 896 R0
SYMATTR InstName R3
SYMATTR Value 1Meg
SYMBOL res 448 720 R0
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL nmos 1088 816 M90
SYMATTR InstName M2
SYMATTR Value BSS138P
SYMATTR Prefix X
SYMBOL res 1264 720 M0
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL voltage 2064 912 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 3.3
SYMBOL voltage 1392 896 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=100
SYMATTR InstName V4
SYMATTR Value PULSE(0 3.3 0 1n 1n {1/baudrate} {2/baudrate})
SYMBOL res 448 880 R0
SYMATTR InstName R2
SYMATTR Value 1Meg
SYMBOL nmos 640 -48 R90
SYMATTR InstName M3
SYMATTR Value BSS138P
SYMATTR Prefix X
SYMBOL res 432 -144 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL res 432 16 R0
SYMATTR InstName R6
SYMATTR Value 1Meg
SYMBOL res 48 -16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 0.01
SYMBOL res 32 848 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 0.01
SYMBOL schottky 1120 -16 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D1
SYMATTR Value BAT54
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 1232 32 R0
SYMATTR InstName R9
SYMATTR Value 1Meg
SYMBOL res 1264 -144 M0
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL schottky 1120 -512 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D2
SYMATTR Value BAT54
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 1232 -464 R0
SYMATTR InstName R11
SYMATTR Value 1Meg
SYMBOL res 1264 -640 M0
SYMATTR InstName R12
SYMATTR Value 1k
SYMBOL voltage 1552 -624 R0
SYMATTR InstName V5
SYMATTR Value 5
SYMBOL res 1232 448 R0
SYMATTR InstName R13
SYMATTR Value 1Meg
SYMBOL nmos 1088 368 M90
SYMATTR InstName M4
SYMATTR Value BSS138P
SYMATTR Prefix X
SYMBOL res 1264 272 M0
SYMATTR InstName R14
SYMATTR Value 1k
TEXT 616 1112 Left 2 ;I²C (or other open-drain bus) level shifting\nV2 can be higher or lower than V3\nWhen V3=0V (e.g. sensor turned off), then there's no leakage from V2 powered circuitry into V3.\nThe 1Mohm resistors are simulating the input impedance of an MCU-pin or sensor-pin.
TEXT -40 1112 Left 2 !.inc BSS138P_2011.txt\n.tran 50u\n.param baudrate=400k
TEXT 1600 -568 Left 2 ;I²C Device 2
TEXT 1896 920 Left 2 ;I²C Device 1
TEXT -144 952 Left 2 ;test supply data
TEXT 432 -424 Left 2 ;Diodes can be replaced by NMOS as done for SDA.  \nCan proof handy when 2NMOS are in one package.
